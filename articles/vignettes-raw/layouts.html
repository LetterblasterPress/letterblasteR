<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="letterblasteR">
<title>Harmonious layouts • letterblasteR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Harmonious layouts">
<meta property="og:description" content="letterblasteR">
<meta property="og:image" content="https://letterblasterpress.github.io/letterblasteR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">letterblasteR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../../articles/vignettes-raw/layouts.html">Harmonious layouts</a>
    <a class="dropdown-item" href="../../articles/vignettes-raw/ratios.html">Harmonious ratios</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/LetterblasterPress/letterblasteR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Harmonious layouts</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/LetterblasterPress/letterblasteR/blob/HEAD/vignettes/vignettes-raw/layouts.qmd" class="external-link"><code>vignettes/vignettes-raw/layouts.qmd</code></a></small>
      <div class="d-none name"><code>layouts.qmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<ul>
<li>Elements of Typographic Style</li>
<li>String harmonics</li>
</ul>
</div>
<div class="section level2">
<h2 id="objective">Objective<a class="anchor" aria-label="anchor" href="#objective"></a>
</h2>
<p>Identify a set of generic (dimensionless) page layouts suitable for
codex-bound text.</p>
</div>
<div class="section level2">
<h2 id="approach">Approach<a class="anchor" aria-label="anchor" href="#approach"></a>
</h2>
<p>Of course, there are infinite ways a rectangular textblock could be
placed on a rectangular page. Here, we will restrict the most important
page layout proportions to compatible combinations of harmonious ratios
(see <code><a href="../../articles/vignettes-raw/ratios.html">vignette("ratios")</a></code>). Then, we’ll run a grid search for
each combination, considering a range of relative textblock sizes.
Margins and secondary page layout proportions are calculated, and
<code><a href="../../reference/round_ratios.html">round_ratios()</a></code> is used to identify solutions that
serendipitously produce harmonious secondary proportions.</p>
<div class="section level3">
<h3 id="exact-proportions-combinatoric">Exact proportions (combinatoric)<a class="anchor" aria-label="anchor" href="#exact-proportions-combinatoric"></a>
</h3>
<ul>
<li>page (square or portrait)</li>
<li>two-page spread</li>
<li>textblock (portrait, different than page proportions)</li>
<li>bottom–top margins (bottom margin larger than top margin)</li>
<li>outer–top margins (outer margin equal to or larger than top
margin)</li>
<li>outer–bottom margins</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combos</span> <span class="op">&lt;-</span> <span class="fu">expand_grid</span><span class="op">(</span></span>
<span>  page_ratio <span class="op">=</span> <span class="va">ratios</span><span class="op">[</span><span class="va">ratios</span> <span class="op">&gt;=</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fl">2</span> <span class="op">/</span> <span class="va">ratios</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ratios</span><span class="op">]</span>,</span>
<span>  text_ratio <span class="op">=</span> <span class="va">ratios</span><span class="op">[</span><span class="va">ratios</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span>,</span>
<span>  bt_ratio <span class="op">=</span> <span class="va">ratios</span><span class="op">[</span><span class="va">ratios</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span>,</span>
<span>  ot_ratio <span class="op">=</span> <span class="va">ratios</span><span class="op">[</span><span class="va">ratios</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">]</span>,</span>
<span>  ob_ratio <span class="op">=</span> <span class="va">ratios</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">page_ratio</span> <span class="op">!=</span> <span class="va">text_ratio</span>, <span class="va">ot_ratio</span> <span class="op">==</span> <span class="va">ob_ratio</span> <span class="op">*</span> <span class="va">bt_ratio</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="approximate-proportions-grid-search">Approximate proportions (grid search)<a class="anchor" aria-label="anchor" href="#approximate-proportions-grid-search"></a>
</h3>
<p>Next, we’ll consider secondary proportions that include the inner
margin. It is overly restrictive (if not impossible) to expect every
proportion to fall into perfect harmony, so we want to consider nearly
perfect solutions. Given the optical foreshortening created by pages
that curve towards the center spine, deviations that produce a slightly
wider proportion may even work in our favor.</p>
<p>Secondary inner-margin proportions:</p>
<ul>
<li>textblock, two-up (spanning inner margins)</li>
<li>outer–inner margins</li>
<li>top–inner margins</li>
<li>bottom–inner margins</li>
<li>outer–inner (2⨉) margins, two-up</li>
<li>top–inner (2⨉) margins, two-up</li>
<li>bottom–inner (2⨉) margins, two-up</li>
</ul>
<p>For clarity and ease of development, we’ll wrap our grid-search logic
in a <a href="https://en.wikipedia.org/wiki/Memoization" class="external-link">memoised</a>
function.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glissando</span> <span class="op">&lt;-</span> <span class="fu">memoise</span><span class="fu">::</span><span class="fu"><a href="https://memoise.r-lib.org/reference/memoise.html" class="external-link">memoise</a></span><span class="op">(</span></span>
<span>  cache <span class="op">=</span> <span class="fu">cachem</span><span class="fu">::</span><span class="fu"><a href="https://cachem.r-lib.org/reference/cache_disk.html" class="external-link">cache_disk</a></span><span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html" class="external-link">dir_create</a></span><span class="op">(</span><span class="st">"memoise_cache"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">pct_height_min</span> <span class="op">=</span> <span class="fl">0.10</span>, <span class="va">pct_height_max</span> <span class="op">=</span> <span class="fl">0.98</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">1e5</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>      <span class="st">"%s -- %s"</span>,</span>
<span>      <span class="fu"><a href="../../reference/name_ratios.html">name_ratios</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">page_ratio</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="../../reference/name_ratios.html">name_ratios</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">text_ratio</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">x</span> <span class="op">|&gt;</span></span>
<span>      <span class="co"># expand dataset to include a range of textblock heights</span></span>
<span>      <span class="fu">mutate</span><span class="op">(</span></span>
<span>        <span class="fu">across</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span>, <span class="co">## reduce object size by removing names</span></span>
<span>        page_height <span class="op">=</span> <span class="va">page_ratio</span>,</span>
<span>        page_width <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        join <span class="op">=</span> <span class="fl">1L</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">left_join</span><span class="op">(</span>by <span class="op">=</span> <span class="st">"join"</span>, relationship <span class="op">=</span> <span class="st">"many-to-many"</span>, <span class="fu">tibble</span><span class="op">(</span></span>
<span>        join <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>        text_height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>          <span class="va">pct_height_min</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">page_ratio</span><span class="op">)</span>,</span>
<span>          <span class="va">pct_height_max</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">page_ratio</span><span class="op">)</span>,</span>
<span>          length.out <span class="op">=</span> <span class="va">n</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">join</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="co"># calculate margins for each layout</span></span>
<span>      <span class="fu">mutate</span><span class="op">(</span></span>
<span>        text_width <span class="op">=</span> <span class="va">text_height</span> <span class="op">/</span> <span class="va">text_ratio</span>,</span>
<span>        b_mar <span class="op">=</span> <span class="op">(</span><span class="va">bt_ratio</span> <span class="op">*</span> <span class="op">(</span><span class="va">page_height</span> <span class="op">-</span> <span class="va">text_height</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">bt_ratio</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>        t_mar <span class="op">=</span> <span class="op">(</span><span class="va">page_height</span> <span class="op">-</span> <span class="va">text_height</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">bt_ratio</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>        o_mar <span class="op">=</span> <span class="va">t_mar</span> <span class="op">*</span> <span class="va">ot_ratio</span>,</span>
<span>        i_mar <span class="op">=</span> <span class="va">page_width</span> <span class="op">-</span> <span class="va">o_mar</span> <span class="op">-</span> <span class="va">text_width</span>,</span>
<span>        oi_ratio <span class="op">=</span> <span class="fu"><a href="../../reference/round_ratios.html">round_ratios</a></span><span class="op">(</span><span class="va">o_mar</span>, <span class="va">i_mar</span>, <span class="st">"wider"</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">i_mar</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">oi_ratio</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="co"># calculate secondary ratios and tidy tibble</span></span>
<span>      <span class="fu">transmute</span><span class="op">(</span></span>
<span>        <span class="va">page_ratio</span>, <span class="co"># exact</span></span>
<span>        page_2up_ratio <span class="op">=</span> <span class="va">page_height</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">page_width</span><span class="op">)</span>, <span class="co"># exact</span></span>
<span>        <span class="va">text_ratio</span>, <span class="co"># exact</span></span>
<span>        text_2up_ratio <span class="op">=</span> <span class="fu"><a href="../../reference/round_ratios.html">round_ratios</a></span><span class="op">(</span><span class="va">text_height</span>, <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">text_width</span> <span class="op">+</span> <span class="va">i_mar</span><span class="op">)</span>, <span class="st">"wider"</span><span class="op">)</span>,</span>
<span>        <span class="va">bt_ratio</span>, <span class="co"># exact</span></span>
<span>        <span class="va">oi_ratio</span>, <span class="co"># rounded</span></span>
<span></span>
<span>        <span class="va">ot_ratio</span>, <span class="co"># exact</span></span>
<span>        <span class="va">ob_ratio</span>, <span class="co"># exact</span></span>
<span>        ti_ratio <span class="op">=</span> <span class="fu"><a href="../../reference/round_ratios.html">round_ratios</a></span><span class="op">(</span><span class="va">t_mar</span>, <span class="va">i_mar</span>, <span class="st">"wider"</span><span class="op">)</span>,</span>
<span>        bi_ratio <span class="op">=</span> <span class="fu"><a href="../../reference/round_ratios.html">round_ratios</a></span><span class="op">(</span><span class="va">b_mar</span>, <span class="va">i_mar</span>, <span class="st">"wider"</span><span class="op">)</span>,</span>
<span>        oii_ratio <span class="op">=</span> <span class="fu"><a href="../../reference/round_ratios.html">round_ratios</a></span><span class="op">(</span><span class="va">o_mar</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">i_mar</span>, <span class="st">"wider"</span><span class="op">)</span>,</span>
<span>        tii_ratio <span class="op">=</span> <span class="fu"><a href="../../reference/round_ratios.html">round_ratios</a></span><span class="op">(</span><span class="va">t_mar</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">i_mar</span>, <span class="st">"wider"</span><span class="op">)</span>,</span>
<span>        bii_ratio <span class="op">=</span> <span class="fu"><a href="../../reference/round_ratios.html">round_ratios</a></span><span class="op">(</span><span class="va">b_mar</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">i_mar</span>, <span class="st">"wider"</span><span class="op">)</span>,</span>
<span>        text_pct <span class="op">=</span> <span class="op">(</span><span class="va">text_height</span> <span class="op">*</span> <span class="va">text_width</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">page_height</span> <span class="op">*</span> <span class="va">page_width</span><span class="op">)</span>,</span>
<span>        <span class="va">page_height</span>, <span class="va">page_width</span>,</span>
<span>        <span class="va">text_height</span>, <span class="va">text_width</span>,</span>
<span>        <span class="va">b_mar</span>, <span class="va">t_mar</span>, <span class="va">o_mar</span>, <span class="va">i_mar</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span></span>
<span>        <span class="fu">matches</span><span class="op">(</span><span class="st">"^(page|page_2up|text|bt|ot|ob)_ratio"</span><span class="op">)</span>,</span>
<span>        <span class="op">~</span> <span class="va">ratios</span><span class="op">[</span><span class="fu"><a href="../../reference/name_ratios.html">name_ratios</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">]</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>With our <code>glissando()</code> function defined, we can identify
harmonious ratios for each of our primary layout combinations.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">layouts</span> <span class="op">&lt;-</span> <span class="va">combos</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">combos</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">page_ratio</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">text_ratio</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">map_dfr</span><span class="op">(</span><span class="va">glissando</span><span class="op">)</span></span></code></pre></div>
</div>
<p>These layouts have quite a bit of redundancy with multiple nearly
identical layouts that fall within our tolerances. Let’s do one more
round, focusing on these solution zones, then we can choose a single
best layout for each motif. Clever trigonometry could perhaps identify
some local maxima, but the resolution of our grid search already takes
us well beyond the resolution of commercial printers.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">layouts</span> <span class="op">&lt;-</span> <span class="va">layouts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span></span>
<span>    <span class="va">layouts</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">group_by</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">ends_with</span><span class="op">(</span><span class="st">"ratio"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">summarise</span><span class="op">(</span></span>
<span>        pct_height_min <span class="op">=</span> <span class="fl">0.9999</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">text_height</span> <span class="op">/</span> <span class="va">page_height</span><span class="op">)</span>,</span>
<span>        pct_height_max <span class="op">=</span> <span class="fl">1.0001</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">text_height</span> <span class="op">/</span> <span class="va">page_height</span><span class="op">)</span>,</span>
<span>        .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">nest</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">combos</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">transmute</span><span class="op">(</span><span class="va">x</span>, <span class="va">pct_height_min</span>, <span class="va">pct_height_max</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">pmap_dfr</span><span class="op">(</span><span class="va">glissando</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Finally, let’s eliminate redundancy by favoring the set of dimensions
that result in the smallest total dissonance (as measured by area beyond
the confines of an ideally proportioned rectangle).</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">layouts</span> <span class="op">&lt;-</span> <span class="va">layouts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    text_2up_err <span class="op">=</span> <span class="op">(</span><span class="va">text_height</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">text_width</span> <span class="op">+</span> <span class="va">i_mar</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span></span>
<span>      <span class="op">(</span><span class="va">text_height</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">text_2up_ratio</span><span class="op">)</span>,</span>
<span>    oi_err <span class="op">=</span> <span class="va">text_height</span> <span class="op">*</span> <span class="op">(</span><span class="va">i_mar</span> <span class="op">-</span> <span class="va">o_mar</span> <span class="op">/</span> <span class="va">oi_ratio</span><span class="op">)</span>,</span>
<span>    ti_err <span class="op">=</span> <span class="op">(</span><span class="va">t_mar</span> <span class="op">*</span> <span class="va">i_mar</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">t_mar</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">ti_ratio</span><span class="op">)</span>,</span>
<span>    bi_err <span class="op">=</span> <span class="op">(</span><span class="va">b_mar</span> <span class="op">*</span> <span class="va">i_mar</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">b_mar</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">bi_ratio</span><span class="op">)</span>,</span>
<span>    oii_err <span class="op">=</span> <span class="va">text_height</span> <span class="op">*</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">i_mar</span> <span class="op">-</span> <span class="va">o_mar</span> <span class="op">/</span> <span class="va">oii_ratio</span><span class="op">)</span>,</span>
<span>    tii_err <span class="op">=</span> <span class="op">(</span><span class="va">t_mar</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">i_mar</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">t_mar</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">tii_ratio</span><span class="op">)</span>,</span>
<span>    bii_err <span class="op">=</span> <span class="op">(</span><span class="va">b_mar</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">i_mar</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">b_mar</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">bii_ratio</span><span class="op">)</span>,</span>
<span>    error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">text_2up_err</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fl">2</span> <span class="op">*</span> <span class="va">oi_err</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">ti_err</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">bi_err</span> <span class="op">+</span></span>
<span>        <span class="va">oii_err</span> <span class="op">+</span> <span class="va">tii_err</span> <span class="op">+</span> <span class="va">bii_err</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># stopifnot(all(layouts$text_2up_err &gt;= 0))</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">layouts</span><span class="op">$</span><span class="va">oi_err</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">layouts</span><span class="op">$</span><span class="va">ti_err</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">layouts</span><span class="op">$</span><span class="va">bi_err</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">layouts</span><span class="op">$</span><span class="va">oii_err</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">layouts</span><span class="op">$</span><span class="va">tii_err</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">layouts</span><span class="op">$</span><span class="va">bii_err</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">layouts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">ends_with</span><span class="op">(</span><span class="st">"ratio"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">text_height</span><span class="op">)</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">range</span> <span class="op">&lt;</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">layouts</span> <span class="op">&lt;-</span> <span class="va">layouts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">slice_min</span><span class="op">(</span><span class="va">error</span>, by <span class="op">=</span> <span class="fu">ends_with</span><span class="op">(</span><span class="st">"ratio"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu">ends_with</span><span class="op">(</span><span class="st">"_err"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span></span>
<span>    <span class="fu">ends_with</span><span class="op">(</span><span class="st">"ratio"</span><span class="op">)</span>,</span>
<span>    <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ratios</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Justin Brantley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
